<!-- edit.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Jogo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        form {
            max-width: 400px;
            margin: 0 auto;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input,
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Editar Jogo</h1>

    <form id="editForm">
        <label for="editName">Nome:</label>
        <input type="text" id="editName" name="editName" required>

        <label for="editReleaseDate">Data de Lançamento:</label>
        <input type="date" id="editReleaseDate" name="editReleaseDate" required>

        <label for="editRating">Avaliação:</label>
        <input type="number" id="editRating" name="editRating" step="0.1" required>

        <label for="editGenre">Gênero:</label>
        <select id="editGenre" name="editGenre" required>
            <!-- Options serão preenchidas dinamicamente com JavaScript -->
        </select>

        <label for="editCompany">Empresa:</label>
        <select id="editCompany" name="editCompany" required>
            <!-- Options serão preenchidas dinamicamente com JavaScript -->
        </select>

        <label for="editPlatform">Plataforma:</label>
        <select id="editPlatform" name="editPlatform" required>
            <!-- Options serão preenchidas dinamicamente com JavaScript -->
        </select>

        <button type="button" onclick="updateGame()">Atualizar Jogo</button>
    </form>

    <script>
        // Função para preencher uma dropdown com opções
        function fillDropdown(dropdownId, options) {
        const dropdown = document.getElementById(dropdownId);

        // Limpar opções existentes
        dropdown.innerHTML = '';

        // Adicionar opção vazia
        const emptyOption = document.createElement('option');
        emptyOption.value = '';
        emptyOption.textContent = '';
        dropdown.appendChild(emptyOption);

        // Preencher as opções
        options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.id;
            optionElement.textContent = option.desc;
            dropdown.appendChild(optionElement);
    });
}


        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Carregar dados de gênero, empresa e plataforma
                const [genres, companies, platforms] = await Promise.all([
                    fetch('http://localhost:3000/genre').then(response => response.json()),
                    fetch('http://localhost:3000/company').then(response => response.json()),
                    fetch('http://localhost:3000/platform').then(response => response.json())
                ]);

                // Preencher as dropdowns com as opções
                fillDropdown('editGenre', genres);
                fillDropdown('editCompany', companies);
                fillDropdown('editPlatform', platforms);

                // Obter o ID do jogo a ser editado da URL
                const urlParams = new URLSearchParams(window.location.search);
                const gameId = urlParams.get('id');

                // Obter dados do jogo a ser editado
                const response = await fetch(`http://localhost:3000/game/${gameId}`);
                const game = await response.json();

                // Preencher os campos do formulário com os dados do jogo
                document.getElementById('editName').value = game.name;
                document.getElementById('editReleaseDate').value = game.release_date;
                document.getElementById('editRating').value = game.rating;
                document.getElementById('editGenre').value = game.genre_id;
                document.getElementById('editCompany').value = game.company_id;
                document.getElementById('editPlatform').value = game.platform_id;

            } catch (error) {
                console.error('Error loading data:', error);
            }
        });

        // Função para atualizar o jogo
        async function updateGame() {
            const gameId = new URLSearchParams(window.location.search).get('id');
            const editForm = document.getElementById('editForm');
            const formData = new FormData(editForm);

            try {
                // Criar um objeto JavaScript com os dados do formulário
                const formDataObject = {};
                formData.forEach((value, key) => {
                    formDataObject[key] = value;
                });

                const response = await fetch(`http://localhost:3000/game/${gameId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formDataObject),
                });

                if (response.ok) {
                    // Jogo atualizado com sucesso - exibir pop-up
                    alert('Jogo atualizado com sucesso!');
                    // Redirecionar para a página de lista de jogos ou realizar outras ações necessárias
                    window.location.href = 'index.html';
                } else {
                    // Exibir mensagem de erro em pop-up
                    alert('Erro ao atualizar jogo: ' + response.statusText);
                }
            } catch (error) {
                // Exibir mensagem de erro em pop-up
                alert('Erro ao atualizar jogo: ' + error.message);
            }
        }
    </script>
</body>
</html>
